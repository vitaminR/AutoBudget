# Auto‑Budget Pilot Plan (Enhanced for Retrieval)

## §1. Core Principles

- **Goal:** ADHD‑friendly app that guides each paycheck, prioritizes **credit‑impacting bills** first, and automates 4 pots (Loans, Bills, Annual, Spending).
- **Pilot principle:** Pick APIs that **easily communicate & initiate automated actions** (low user friction).
- **Nice‑to‑have:** In‑app bill pay.

## §2. Financial Situation (Baseline)

- Income: $3,800 (you) + $800 (wife) = **$4,600 biweekly** (~$9,967/mo).
- Rent + Electric: $3,400 (1st).
- Loans: Jeep $875 (27th), Van $237 (9th), Bike $208 (5th).
- Credit Cards: Amex $152 (8th), NFCU $250 (20th), Best Buy $85 (22nd), Home Depot $80 (1st).
- Insurance: Health $240 (1st), Car $417 (20th), Bike $70 (17th).
- Phones: GoogleFi $78 (1st), Mint $46 (20th).
- Storage: $560 (split PP1+PP2). Food: $500 per PP.
- Other: Dog Meds $150, Gas $12.
- Debt: ~**$100K** total. Surplus ~ **$100–$200/mo** before unlocks.

**PP-Negative Rule (Critical):**  
If a paycheck’s income < Credit + Bills:

1. Defer all _Secondary_ expenses.
2. Auto-trim Annual pot contributions.
3. Lock Spending pot (no unlocks).
4. Alert user via digest + dashboard banner.

## §3. Pots (4‑Bucket System)

- **Loans:** fund minimums → snowball extra to smallest balance.
- **Bills:** rent/utilities/phones/insurance/storage (must‑fund per PP by due date).
- **Annual:** sinking funds; auto‑save per PP.
- **Spending:** locked; unlock $100/spouse after **Credit ✔ + Pots ✔**.

## §4. Tech Stack (Pilot MVP)

### Rails/APIs

- **Plaid**: Link → Accounts, Transactions, Balances, Auth. Transfers via `/transfer/*` (optional).
- **Dwolla**: Customers, Funding Sources, **Transfers** (`POST /transfers`) for unlocks.
- _(Later)_ Sequence Pods, Atomic FI (payroll split), Unit.co (BaaS).
- **Observability:** OpenTelemetry or Sentry for API error logging, Plaid/Dwolla webhook failures, reconciliation mismatches.

### Backend

- **FastAPI** + SQLite → Postgres. APScheduler for nightly reconciliation + digests.
- Adapters: Plaid (data), Dwolla (ACH). Virtual pots via **double‑entry ledger**.

### Frontend

- **Next.js/React**: Dashboard (next paycheck), PP pages (credit‑first list + ✔), Debt page (snowball), Settings.

## §5. Data Model (Virtual Pots)

- **users**(id, email, name, role)
- **households**(id, owner_user_id)
- **accounts**(id, plaid_item_id, dwolla_funding_id, type)
- **pots**(id, household_id, name, target_cents) — Loans, Bills, Annual, Spending
- **journal_entries**(id, ts, idempotency_key, actor)
- **postings**(entry_id, account, debit, credit, memo)
- **pp_bills**(id, pp_no, name, due_day, class, amount, paid_bool, externalPayeeId, cutoffDay)
- **checklists**(pp_no, spouse, credit_done, pots_done, unlocked_cents)
- **webhook_events**(id, provider, payload, status)

## §6. Checklist + Unlock Flow

1. Payday → see **credit‑first** bill list for the PP.
2. Mark **Credit** bills ✔; mark **Pots** ✔.
3. Server validates; books ledger entry; **Dwolla** `POST /transfers` → release **$100** to spouse’s account.
4. Mark PP **closed**; email digest.

## §7. User Stories

### Onboarding

1. Link bank (Plaid) in one click.
2. Auto‑classify bills into 4 pots.
3. Confirm paycheck setup (amount + frequency).
4. Set spouse unlock accounts.

### Monthly Use (per PP)

1. See PP bills (credit‑first).
2. ✔ each bill when paid/verified.
3. ✔ Pots verified; unlock $100/spouse.
4. View debt countdown; get weekly email digest.
5. See monthly summary (income vs bills vs debt change).
6. As a user, I want to see motivational milestones (e.g., “Debt reduced by $500 this month”) so I feel progress beyond unlocks.

## §8. Cost Estimate (MVP per user)

- **Plaid**: ~60 calls/mo → ~$0.50–$1.00.
- **Dwolla**: ~4 transfers/mo → ~$2–$4.
- **Email**: negligible. Infra shared.
- **Total**: **$3–$5/user/mo**.
- **Hidden Costs:** Plaid Auth/Identity calls may be priced separately; Dwolla may impose monthly minimum fees. Monitor contracts early.

## §9. Risks & Safeguards

- Plaid mismatch: nightly reconciliation; auto re‑lock.
- Double unlock: idempotency + PP closed flag.
- ACH returns: Dwolla webhooks → reverse posting + notify.
- UX overload: guided wizard with defaults.

- **Security:** Rotate Plaid/Dwolla tokens every 90 days; encrypt at rest; redact from logs.
- **Observability:** Track KPIs — Plaid call volume, reconciliation mismatches, unlock attempts, ACH return codes. Alerts trigger re-lock on anomalies.

## §10. Next Steps

1. FastAPI + SQLite: `/ingest/csv`, `/pp/{no}`.
2. Dwolla sandbox transfers for unlock.
   2a. Build ledger core (journal_entries + postings) with tests before UI, to de-risk data integrity.
3. Plaid adapter (balances + txns nightly).
4. React PP pages + ✔.
5. Checklist + unlock flow.
6. Debt countdown + weekly digest.
7. Test with Jace’s CSV (PP17–PP26).
8. Multi‑tenant `customers` table.

---

## Glossary (Keywords for Retrieval)

- **PP**: Pay Period (biweekly).
- **Pots**: Loans, Bills, Annual, Spending (virtual envelopes).
- **Snowball**: pay smallest balance first; roll freed payment to next.
- **Unlock**: $100 transfer/spouse after **Credit ✔ + Pots ✔**.
- **Ledger**: double‑entry journal + postings (append‑only).
- **Reconciliation**: match ledger vs Plaid txns/balances nightly.

## Vendor Matrix (Keywords)

- **Plaid**: `link`, `accounts/get`, `transactions/sync`, `balances/get`, `auth/get`, `transfer/authorization/create`, `transfer/create`.
- **Dwolla**: `customers`, `funding-sources`, **`transfers (POST /transfers)`**, `webhooks`, `ACH returns`.
- **Sequence (later)**: `pods`, `rules`, `remote-api trigger`.
- **Atomic FI (later)**: `deposit switch`, `Transact SDK`.

## Q&A Cards (Short)

- **Q:** What triggers an unlock? **A:** **Credit ✔ + Pots ✔** → server calls Dwolla transfer for $100 (per spouse).
- **Q:** How are pots enforced in MVP? **A:** Virtual ledger + nightly Plaid reconciliation.
- **Q:** What if PP bills > income? **A:** Defer **Secondary**, auto‑trim **Annual**, lock **Spending**; alert user.
- **Q:** Hidden costs? **A:** Plaid product minimums; Dwolla per‑transfer fees; monitor call volume and batch/caching.
