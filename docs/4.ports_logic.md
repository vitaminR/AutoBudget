
# Pots Logic with Plaid + Dwolla — Pilot Brief

## 1) Summary (Why this design)
Model **four virtual pots** (Loans, Bills, Annual, Spending) in your app using a small **double‑entry ledger** and reconcile nightly with **Plaid**. Move cash when needed via **Dwolla** transfers. This avoids bank‑core complexity while enforcing ADHD‑friendly guardrails (credit‑first + checklist unlocks).

## 2) The Four Pots
- **Loans** — Credit‑report items (cards + loans). Fund minimums first, then snowball extra to smallest balance.
- **Bills** — Monthly essentials (rent/electric, insurance, phones, storage). Prefund each pay period by due date.
- **Annual** — Sinking funds for yearly/quarterly obligations (registrations, premiums, annual subs). Sweep per PP.
- **Spending** — Locked discretionary. Unlock $100 per spouse only after **Credit ✔** and **Pots ✔** for the current pay period.

## 3) Virtual vs Real Buckets
- **Virtual Pots (MVP)** — One real checking account; pots are **internal balances** tracked in your ledger. Nightly Plaid reconciliation keeps them honest.
- **Real Buckets (Later)** — Sub‑accounts (Sequence pods or bank “vaults/buckets”) for hard separation; add once MVP proves behavior.

## 4) Ledger & Reconciliation (MVP)
- **Journal entries** (append‑only) with two **postings** per move (debit pot, credit checking) for balance integrity.
- **Reconciliation job (nightly)** pulls Plaid balances/transactions; marks postings **reconciled** on match (amount/date/memo). Variances trigger alerts + auto re‑lock of Spending.
- **Idempotency** on any unlock or transfer. PP marked **closed** after first successful unlock.

## 5) Guided Onboarding (ADHD‑friendly)
1. **Connect Bank (Plaid Link)** → show balances & recent transactions.
2. **Create Pots** → prefilled Loans/Bills/Annual/Spending from detected bills; user confirms.
3. **Paycheck Setup** → “$4,600 biweekly; we’ll auto‑allocate Loans min → Bills → Annual; Spending stays locked.”
4. **Spouse Destinations** → set where $100 unlocks go (Dwolla funding sources).
5. **First Run** → see this PP’s credit‑first bill list and the lock status for Spending.

## 6) Checklist + Unlock Flow
- User marks **Credit bills ✔** (paid/verified) and **Pots ✔** (targets met).  
- Backend validates → books ledger entry → **Dwolla POST /transfers** releases **$100** to the selected spouse account.  
- PP set to **closed**; weekly digest email sent.

## 7) Risk Controls
- **Double unlock:** idempotency keys + unique DB constraint + PP closed flag.
- **ACH returns:** Dwolla webhooks → reverse posting, re‑lock Spending, notify.
- **API limits:** backoff + caching for Plaid (balances/txns); batch where possible.
- **Secrets:** encrypt Plaid/Dwolla tokens; never log PII/keys; rotate regularly.
- **Auditability:** immutable event log (who unlocked, when, how much).

## 8) Nice‑to‑Have (Post‑MVP)
- **In‑app bill pay** (store `externalPayeeId`, cutoff windows, retry policy).
- **Payroll split** (Atomic FI / Plaid Deposit Switch) to fund Holding before checking.
- **Real buckets** (Sequence pods or bank sub‑accounts) once behavior is stable.

